<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
    .table{
        margin-top: 100px;
		
    }

    .table td{
        font-size: 14px;
        padding: 0px !important;
    }
</style>
<body>
<div class="container">
    <div class="row">
        <h1>Demo Orderbook</h1>
    </div>
    <div class="row">
        <div class="form-group">
            <select class="form-control" id="symbol">
                <option>BTCUSDT</option>
                <option>BNBBTC</option>
                <option>XRPBTC</option>
                <option>ETHBTC</option>
            </select>
        </div>
    </div>
    <div class="row">
        <h3 class="text-center">ASK</h3>
    </div>
    <div class="row" style="margin-top: -90px">
        <table class="table ask col-sm-6">
            <tbody></tbody>
        </table>
        <div class="col-sm-6" id="chartContainer1" style="height: 400px;width: 100%"></div>
    </div>
    <div class="row">
        <h3 class="text-center">BID</h3>
    </div>
    <div class="row" style="margin-top: -100px">
        <table class="table bid col-sm-6">
            <tbody></tbody>
        </table>
        <div class="col-sm-6" id="chartContainer2" style="height: 400px;width: 100%"></div>
    </div>
</div>
</body>
<script>
    setInterval(orderBook, 1000);
//    orderBook();
    function orderBook() {
        var ourRequest = new XMLHttpRequest();
        ourRequest.open('GET', 'https://cors-anywhere.herokuapp.com/https://api.binance.com/api/v1/depth?symbol=' + document.getElementById("symbol").value + '&limit=10', true);
        ourRequest.onload = function () {
            ourData = JSON.parse(ourRequest.responseText);
            var xAsk = [], yAsk = [], xBid = [], yBid = [];

            //Collect Data for Asks
            for (i = 0; i < 10; i++) {
                xAsk.push(parseFloat(ourData["asks"][i][1]));
                yAsk.push((ourData["asks"][i][0] * 1).toString() + '_');
            }

            updateData(xAsk, yAsk, 1);

            //Collect Data for Bids
            for (i = 9; i >= 0; i--) {
                xBid.push(parseFloat(ourData["bids"][i][1]));
                yBid.push((ourData["bids"][i][0] * 1).toString() + '_');
            }

            updateData(xBid, yBid, 2);
            //Display Chart for Asks
            var data1 = [{
                type: 'bar',
                x: xAsk,
                y: yAsk,
                marker: {
                    color: 'rgb(160, 9, 9)',
                },
                orientation: 'h'
            }];

            var askLayout = {title: 'ASK'};

            Plotly.newPlot('chartContainer1', data1);

            //Display Chart for Bids
            var data2 = [{
                type: 'bar',
                x: xBid,
                y: yBid,
                marker: {
                    color: 'rgb(3, 119, 73)'
                },
                orientation: 'h'
            }];

            var bidLayout = {title: 'BID'};

            Plotly.newPlot('chartContainer2', data2);

        }
        ourRequest.send();

    }

    function updateData(xdata, ydata, type) {
        var content = '';

        for (i = 0; i < 10; i++) {
            content += '<tr>';
            content += '<td>' + ydata[i].replace('_', '') + '</td>';
            content += '<td>' + xdata[i] + '</td>';
            content += '</tr>';
        }

        if (type === 1) {
            $('.ask tbody').html(content);
        } else {
            $('.bid tbody').html(content);
        }

    }

</script>
</html>